<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>NSE Bhavcopy Web Visualizer</title>
    <link rel="stylesheet"
          href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
</head>
<body class="bg-light">

<nav class="navbar navbar-dark bg-primary mb-4">
    <div class="container-fluid">
        <span class="navbar-brand mb-0 h1">NSE Bhavcopy Web Visualizer</span>
    </div>
</nav>

<div class="container">

    <!-- MAIN FORM -->
    <form method="POST" class="row g-3 mb-4">
        <input type="hidden" name="page" value="{{ page or 1 }}">

        <div class="col-md-3">
            <label class="form-label">Date</label>
            <input type="text" class="form-control" name="trade_date"
                   value="{{ trade_date or '' }}" placeholder="02-12-2025">
        </div>

        <div class="col-md-3">
            <label class="form-label">Stock Symbol (optional)</label>
            <input type="text" class="form-control" name="stock_symbol"
                   value="{{ stock_symbol or '' }}" placeholder="RELIANCE">
        </div>

        <div class="col-md-2 d-flex align-items-end">
            <button type="submit" class="btn btn-primary w-100">Load</button>
            <a href="/download" class="btn btn-success mt-3">Download This Page (Excel)</a>
        </div>
    </form>

    <!-- ERROR -->
    {% if error %}
        <div class="alert alert-danger">{{ error }}</div>
    {% endif %}

    <!-- MAIN DATA TABLE -->
    {% if table_html %}
        <div class="card mb-3">
            <div class="card-header">Stocks (30 per page)</div>
            <div class="card-body">
                {{ table_html|safe }}
            </div>
        </div>

        <!-- PAGINATION BUTTONS -->
        <div class="d-flex justify-content-between mb-4">
            <form method="POST">
                <input type="hidden" name="trade_date" value="{{ trade_date }}">
                <input type="hidden" name="stock_symbol" value="{{ stock_symbol }}">
                <input type="hidden" name="page" value="{{ page - 1 }}">
                {% if page > 1 %}
                    <button class="btn btn-secondary">Previous</button>
                {% endif %}
            </form>

            <span class="align-self-center">
                Page {{ page }} of {{ total_pages }}
            </span>

            <form method="POST">
                <input type="hidden" name="trade_date" value="{{ trade_date }}">
                <input type="hidden" name="stock_symbol" value="{{ stock_symbol }}">
                <input type="hidden" name="page" value="{{ page + 1 }}">
                {% if page < total_pages %}
                    <button class="btn btn-secondary">Next</button>
                {% endif %}
            </form>
        </div>
    {% endif %}

    <!-- STOCK-SPECIFIC TABLE -->
    {% if stock_msg %}
        <div class="alert alert-info">{{ stock_msg }}</div>
    {% endif %}

    {% if stock_table_html %}
        <div class="card mb-4">
            <div class="card-header">Selected Stock</div>
            <div class="card-body">
                {{ stock_table_html|safe }}
            </div>
        </div>
    {% endif %}

    <!-- CHART -->
    {% if fig1 %}
        <div class="card mb-4">
            <div class="card-header">Top 10 by Traded Value</div>
            <div class="card-body">
                {{ fig1|safe }}
            </div>
        </div>
    {% endif %}

</div>
</body>
</html>
